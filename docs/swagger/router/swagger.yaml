basePath: /v1
definitions:
  github_com_sharding-system_pkg_models.CreateShardRequest:
    properties:
      name:
        type: string
      primary_endpoint:
        type: string
      replicas:
        items:
          type: string
        type: array
      vnode_count:
        type: integer
    type: object
  github_com_sharding-system_pkg_models.MergeRequest:
    properties:
      source_shard_ids:
        items:
          type: string
        type: array
      target_shard:
        $ref: '#/definitions/github_com_sharding-system_pkg_models.CreateShardRequest'
    type: object
  github_com_sharding-system_pkg_models.QueryRequest:
    properties:
      consistency:
        description: '"strong" or "eventual"'
        type: string
      options:
        additionalProperties: true
        type: object
      params:
        items: {}
        type: array
      query:
        type: string
      shard_key:
        type: string
    type: object
  github_com_sharding-system_pkg_models.QueryResponse:
    properties:
      latency_ms:
        type: number
      row_count:
        type: integer
      rows:
        items: {}
        type: array
      shard_id:
        type: string
    type: object
  github_com_sharding-system_pkg_models.ReshardJob:
    properties:
      completed_at:
        type: string
      error_message:
        type: string
      id:
        type: string
      keys_migrated:
        type: integer
      progress:
        description: 0.0 to 1.0
        type: number
      source_shards:
        items:
          type: string
        type: array
      started_at:
        type: string
      status:
        description: '"pending", "precopy", "deltasync", "cutover", "completed", "failed"'
        type: string
      target_shards:
        items:
          type: string
        type: array
      total_keys:
        type: integer
      type:
        description: '"split" or "merge"'
        type: string
    type: object
  github_com_sharding-system_pkg_models.Shard:
    properties:
      created_at:
        type: string
      hash_range_end:
        type: integer
      hash_range_start:
        type: integer
      id:
        type: string
      name:
        type: string
      primary_endpoint:
        type: string
      replicas:
        items:
          type: string
        type: array
      status:
        description: '"active", "migrating", "readonly", "inactive"'
        type: string
      updated_at:
        type: string
      version:
        type: integer
      vnodes:
        items:
          $ref: '#/definitions/github_com_sharding-system_pkg_models.VNode'
        type: array
    type: object
  github_com_sharding-system_pkg_models.SplitRequest:
    properties:
      source_shard_id:
        type: string
      split_point:
        description: Optional explicit split point
        type: integer
      target_shards:
        items:
          $ref: '#/definitions/github_com_sharding-system_pkg_models.CreateShardRequest'
        type: array
    type: object
  github_com_sharding-system_pkg_models.VNode:
    properties:
      hash:
        type: integer
      id:
        type: integer
      shard_id:
        type: string
    type: object
host: localhost:8080
info:
  contact:
    email: support@sharding-system.com
    name: API Support
  description: API for routing requests to shards based on shard keys
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT
  termsOfService: http://swagger.io/terms/
  title: Sharding System Router API
  version: "1.0"
paths:
  /execute:
    post:
      consumes:
      - application/json
      description: Executes a SQL query on the shard determined by the shard key
      parameters:
      - description: Query Request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/github_com_sharding-system_pkg_models.QueryRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Query executed successfully
          schema:
            $ref: '#/definitions/github_com_sharding-system_pkg_models.QueryResponse'
        "400":
          description: Bad request
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties: true
            type: object
      summary: Execute a query on a shard
      tags:
      - router
  /reshard/jobs/{id}:
    get:
      consumes:
      - application/json
      description: Retrieves the status of a resharding job by job ID
      parameters:
      - description: Job ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Job status
          schema:
            $ref: '#/definitions/github_com_sharding-system_pkg_models.ReshardJob'
        "404":
          description: Job not found
          schema:
            additionalProperties: true
            type: object
      summary: Get reshard job status
      tags:
      - resharding
  /reshard/merge:
    post:
      consumes:
      - application/json
      description: Merges multiple source shards into a target shard
      parameters:
      - description: Merge Request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/github_com_sharding-system_pkg_models.MergeRequest'
      produces:
      - application/json
      responses:
        "202":
          description: Merge job started
          schema:
            $ref: '#/definitions/github_com_sharding-system_pkg_models.ReshardJob'
        "400":
          description: Bad request
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties: true
            type: object
      summary: Merge shards
      tags:
      - resharding
  /reshard/split:
    post:
      consumes:
      - application/json
      description: Splits a shard into multiple target shards
      parameters:
      - description: Split Request
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/github_com_sharding-system_pkg_models.SplitRequest'
      produces:
      - application/json
      responses:
        "202":
          description: Split job started
          schema:
            $ref: '#/definitions/github_com_sharding-system_pkg_models.ReshardJob'
        "400":
          description: Bad request
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties: true
            type: object
      summary: Split a shard
      tags:
      - resharding
  /shard-for-key:
    get:
      consumes:
      - application/json
      description: Returns the shard ID that handles the given key
      parameters:
      - description: Shard key
        in: query
        name: key
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Shard ID
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad request
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties: true
            type: object
      summary: Get shard ID for a key
      tags:
      - router
  /shards:
    get:
      consumes:
      - application/json
      description: Returns a list of all shards in the system
      produces:
      - application/json
      responses:
        "200":
          description: List of shards
          schema:
            items:
              $ref: '#/definitions/github_com_sharding-system_pkg_models.Shard'
            type: array
        "500":
          description: Internal server error
          schema:
            additionalProperties: true
            type: object
      summary: List all shards
      tags:
      - shards
    post:
      consumes:
      - application/json
      description: Creates a new database shard with the specified configuration
      parameters:
      - description: Shard Configuration
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/github_com_sharding-system_pkg_models.CreateShardRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Shard created successfully
          schema:
            $ref: '#/definitions/github_com_sharding-system_pkg_models.Shard'
        "400":
          description: Bad request
          schema:
            additionalProperties: true
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties: true
            type: object
      summary: Create a new shard
      tags:
      - shards
  /shards/{id}:
    delete:
      consumes:
      - application/json
      description: Deletes a shard by ID
      parameters:
      - description: Shard ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: Shard deleted successfully
        "400":
          description: Bad request
          schema:
            additionalProperties: true
            type: object
      summary: Delete a shard
      tags:
      - shards
    get:
      consumes:
      - application/json
      description: Retrieves shard information by shard ID
      parameters:
      - description: Shard ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Shard information
          schema:
            $ref: '#/definitions/github_com_sharding-system_pkg_models.Shard'
        "404":
          description: Shard not found
          schema:
            additionalProperties: true
            type: object
      summary: Get shard by ID
      tags:
      - shards
  /shards/{id}/promote:
    post:
      consumes:
      - application/json
      description: Promotes a replica to become the primary shard
      parameters:
      - description: Shard ID
        in: path
        name: id
        required: true
        type: string
      - description: Replica Promotion Request
        in: body
        name: request
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: Replica promoted successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad request
          schema:
            additionalProperties: true
            type: object
      summary: Promote a replica to primary
      tags:
      - shards
swagger: "2.0"
